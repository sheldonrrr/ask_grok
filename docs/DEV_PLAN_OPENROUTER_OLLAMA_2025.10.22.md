# OpenRouter å’Œ Ollama é›†æˆå¼€å‘è®¡åˆ’
**åˆ›å»ºæ—¥æœŸ**: 2025-10-22  
**ç›®æ ‡**: ä¸º Ask Grok æ’ä»¶æ·»åŠ  OpenRouter å’Œ Ollama ä¸¤ä¸ªæ–°çš„ AI æä¾›å•†æ”¯æŒ

---

## ä¸€ã€éœ€æ±‚åˆ†æ

### 1.1 OpenRouter ç‰¹æ€§
- **API æ ¼å¼**: OpenAI å…¼å®¹ï¼ˆæ ‡å‡†æ ¼å¼ï¼‰
- **è®¤è¯æ–¹å¼**: Bearer Tokenï¼ˆAPI Keyï¼‰
- **Base URL**: `https://openrouter.ai/api/v1`
- **ç‰¹æ®Šè¯·æ±‚å¤´**ï¼ˆå¯é€‰ï¼‰:
  - `HTTP-Referer`: ç”¨äºåœ¨ OpenRouter ä¸Šè¿›è¡Œæ’å
  - `X-Title`: åº”ç”¨åç§°æ ‡è¯†
- **æ¨¡å‹åˆ—è¡¨ç«¯ç‚¹**: `GET /models`
- **èŠå¤©ç«¯ç‚¹**: `POST /chat/completions`
- **æ¨¡å‹åç§°æ ¼å¼**: å¸¦å‰ç¼€ï¼Œå¦‚ `openai/gpt-4o`
- **æµå¼ä¼ è¾“**: æ”¯æŒï¼ˆOpenAI å…¼å®¹ï¼‰

### 1.2 Ollama ç‰¹æ€§
- **API æ ¼å¼**: è‡ªå®šä¹‰æ ¼å¼ï¼ˆé OpenAI å…¼å®¹ï¼‰
- **è®¤è¯æ–¹å¼**: æ— éœ€è®¤è¯ï¼ˆæœ¬åœ°æœåŠ¡ï¼‰
- **Base URL**: `http://localhost:11434`ï¼ˆé»˜è®¤ï¼‰
- **æ¨¡å‹åˆ—è¡¨ç«¯ç‚¹**: `GET /api/tags`ï¼ˆ**ç‰¹æ®Š**ï¼‰
- **èŠå¤©ç«¯ç‚¹**: `POST /api/chat`ï¼ˆ**ç‰¹æ®Š**ï¼‰
- **è¯·æ±‚ä½“æ ¼å¼**: ä¸ OpenAI ä¸åŒ
- **å“åº”æ ¼å¼**: è‡ªå®šä¹‰æ ¼å¼
- **æµå¼ä¼ è¾“**: æ”¯æŒï¼ˆä½†æ ¼å¼ä¸åŒï¼‰

### 1.3 åŠŸèƒ½è¦†ç›–èŒƒå›´
å¿…é¡»æ”¯æŒä»¥ä¸‹åœºæ™¯ï¼š
1. **Load Models**: ä» API è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
2. **Send (æ™®é€šé—®ç­”)**: å‘é€ç”¨æˆ·é—®é¢˜å¹¶è·å–å›ç­”ï¼ˆæ”¯æŒæµå¼/éæµå¼ï¼‰
3. **Random Question**: ç”Ÿæˆéšæœºé—®é¢˜ï¼ˆéæµå¼ï¼‰
4. **é…ç½®é€‰é¡¹**:
   - å¯ç”¨/ç¦ç”¨æµå¼ä¼ è¾“
   - è‡ªå®šä¹‰æ¨¡å‹åç§°æ”¯æŒ
   - API Key é…ç½®ï¼ˆOpenRouterï¼‰
   - Base URL é…ç½®

---

## äºŒã€æŠ€æœ¯æ¶æ„åˆ†æ

### 2.1 ç°æœ‰ä»£ç ç»“æ„
```
models/
â”œâ”€â”€ base.py           # åŸºç¡€æŠ½è±¡ç±» BaseAIModel + AIModelFactory
â”œâ”€â”€ __init__.py       # æ¨¡å‹æ³¨å†Œ
â”œâ”€â”€ grok.py           # OpenAI å…¼å®¹å®ç°ç¤ºä¾‹
â”œâ”€â”€ openai.py         # OpenAI æ ‡å‡†å®ç°
â”œâ”€â”€ anthropic.py      # é OpenAI å…¼å®¹å®ç°ç¤ºä¾‹
â”œâ”€â”€ nvidia.py         # OpenAI å…¼å®¹å®ç°
â”œâ”€â”€ gemini.py         # ç‰¹æ®Šæ ¼å¼å®ç°
â”œâ”€â”€ deepseek.py       # OpenAI å…¼å®¹å®ç°
â””â”€â”€ custom.py         # è‡ªå®šä¹‰å®ç°
```

### 2.2 BaseAIModel å¿…é¡»å®ç°çš„æ–¹æ³•
```python
# æ ¸å¿ƒæ–¹æ³•
- _validate_config()              # éªŒè¯é…ç½®
- get_token()                     # è·å– API Token
- validate_token()                # éªŒè¯ Token
- prepare_headers()               # å‡†å¤‡è¯·æ±‚å¤´
- prepare_request_data()          # å‡†å¤‡è¯·æ±‚æ•°æ®
- ask()                           # å‘é€è¯·æ±‚å¹¶è·å–å“åº”
- supports_streaming()            # æ˜¯å¦æ”¯æŒæµå¼ä¼ è¾“
- get_model_name()                # è·å–å½“å‰æ¨¡å‹åç§°
- get_provider_name()             # è·å–æä¾›å•†åç§°
- get_default_config()            # è·å–é»˜è®¤é…ç½®

# å¯é€‰æ–¹æ³•ï¼ˆæœ‰é»˜è®¤å®ç°ï¼‰
- fetch_available_models()        # è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨ï¼ˆOpenAI å…¼å®¹æ ¼å¼ï¼‰
```

### 2.3 å…³é”®å·®å¼‚ç‚¹

#### OpenRouter vs æ ‡å‡† OpenAI
| ç‰¹æ€§ | OpenRouter | æ ‡å‡† OpenAI |
|------|-----------|------------|
| Base URL | `https://openrouter.ai/api/v1` | `https://api.openai.com/v1` |
| è®¤è¯ | Bearer Token | Bearer Token |
| æ¨¡å‹åˆ—è¡¨ | `GET /models` | `GET /models` |
| èŠå¤©ç«¯ç‚¹ | `POST /chat/completions` | `POST /chat/completions` |
| ç‰¹æ®Šè¯·æ±‚å¤´ | `HTTP-Referer`, `X-Title` | æ—  |
| æ¨¡å‹åç§° | å¸¦å‰ç¼€ï¼ˆå¦‚ `openai/gpt-4o`ï¼‰ | æ ‡å‡†åç§° |

**ç»“è®º**: OpenRouter å¯ä»¥ç»§æ‰¿ OpenAI å…¼å®¹å®ç°ï¼Œåªéœ€é‡å†™ `prepare_headers()` æ·»åŠ å¯é€‰è¯·æ±‚å¤´ã€‚

#### Ollama vs æ ‡å‡† OpenAI
| ç‰¹æ€§ | Ollama | æ ‡å‡† OpenAI |
|------|--------|------------|
| Base URL | `http://localhost:11434` | `https://api.openai.com/v1` |
| è®¤è¯ | æ—  | Bearer Token |
| æ¨¡å‹åˆ—è¡¨ | `GET /api/tags` | `GET /models` |
| èŠå¤©ç«¯ç‚¹ | `POST /api/chat` | `POST /chat/completions` |
| è¯·æ±‚æ ¼å¼ | è‡ªå®šä¹‰ | OpenAI æ ‡å‡† |
| å“åº”æ ¼å¼ | è‡ªå®šä¹‰ | OpenAI æ ‡å‡† |

**ç»“è®º**: Ollama éœ€è¦å®Œå…¨è‡ªå®šä¹‰å®ç°ï¼Œä¸èƒ½ä½¿ç”¨åŸºç±»çš„ OpenAI å…¼å®¹æ–¹æ³•ã€‚

---

## ä¸‰ã€å®ç°æ–¹æ¡ˆ

### 3.1 OpenRouter å®ç°ï¼ˆç®€å•ï¼‰

#### 3.1.1 ç»§æ‰¿ç­–ç•¥
```python
class OpenRouterModel(BaseAIModel):
    # ç»§æ‰¿åŸºç±»çš„ OpenAI å…¼å®¹å®ç°
    # åªéœ€é‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š
    - prepare_headers()      # æ·»åŠ  HTTP-Referer å’Œ X-Title
    - get_provider_name()    # è¿”å› "OpenRouter"
    - get_model_name()       # è¿”å›å½“å‰æ¨¡å‹
```

#### 3.1.2 ç‰¹æ®Šå¤„ç†
- **å¯é€‰è¯·æ±‚å¤´**: åœ¨é…ç½®ä¸­æ·»åŠ  `http_referer` å’Œ `x_title` å­—æ®µ
- **æ¨¡å‹åç§°**: æ”¯æŒå¸¦å‰ç¼€çš„æ¨¡å‹åç§°ï¼ˆå¦‚ `openai/gpt-4o`ï¼‰
- **fetch_available_models()**: ä½¿ç”¨åŸºç±»é»˜è®¤å®ç°ï¼ˆOpenAI å…¼å®¹ï¼‰

#### 3.1.3 é…ç½®å­—æ®µ
```python
{
    "api_key": "",                    # å¿…éœ€
    "api_base_url": "https://openrouter.ai/api/v1",
    "model": "openai/gpt-4o",         # é»˜è®¤æ¨¡å‹
    "enable_streaming": True,
    "http_referer": "",               # å¯é€‰
    "x_title": "Ask Grok Calibre Plugin"  # å¯é€‰
}
```

### 3.2 Ollama å®ç°ï¼ˆå¤æ‚ï¼‰

#### 3.2.1 å®Œå…¨è‡ªå®šä¹‰å®ç°
```python
class OllamaModel(BaseAIModel):
    # éœ€è¦é‡å†™æ‰€æœ‰æ ¸å¿ƒæ–¹æ³•ï¼š
    - _validate_config()           # API Key å¯é€‰
    - get_token()                  # è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆæ— éœ€è®¤è¯ï¼‰
    - validate_token()             # è·³è¿‡éªŒè¯
    - prepare_headers()            # åªéœ€ Content-Type
    - prepare_request_data()       # è‡ªå®šä¹‰æ ¼å¼
    - ask()                        # å®Œå…¨è‡ªå®šä¹‰å®ç°
    - fetch_available_models()     # ä½¿ç”¨ /api/tags ç«¯ç‚¹
    - get_provider_name()          # è¿”å› "Ollama"
    - get_model_name()             # è¿”å›å½“å‰æ¨¡å‹
```

#### 3.2.2 ç‰¹æ®Šç«¯ç‚¹
- **æ¨¡å‹åˆ—è¡¨**: `GET ${baseUrl}/api/tags`
  - å“åº”æ ¼å¼: `{ "models": [{ "name": "llama3", ... }] }`
- **èŠå¤©è¯·æ±‚**: `POST ${baseUrl}/api/chat`
  - è¯·æ±‚æ ¼å¼:
    ```json
    {
      "model": "llama3",
      "messages": [...],
      "stream": false
    }
    ```
  - å“åº”æ ¼å¼ï¼ˆéæµå¼ï¼‰:
    ```json
    {
      "message": {
        "role": "assistant",
        "content": "..."
      }
    }
    ```

#### 3.2.3 æµå¼ä¼ è¾“å¤„ç†
Ollama çš„æµå¼å“åº”æ ¼å¼ï¼š
```
{"message":{"role":"assistant","content":"Hello"},"done":false}
{"message":{"role":"assistant","content":" world"},"done":false}
{"message":{"role":"assistant","content":"!"},"done":true}
```

æ¯è¡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ JSON å¯¹è±¡ï¼Œä¸æ˜¯ SSE æ ¼å¼ã€‚

#### 3.2.4 é…ç½®å­—æ®µ
```python
{
    "api_key": "",                    # å¯é€‰ï¼ˆæœ¬åœ°ä¸éœ€è¦ï¼‰
    "api_base_url": "http://localhost:11434",
    "model": "llama3",                # é»˜è®¤æ¨¡å‹
    "enable_streaming": True,
    "disable_ssl_verify": True        # æœ¬åœ°æœåŠ¡é€šå¸¸éœ€è¦
}
```

---

## å››ã€å¼€å‘ä»»åŠ¡æ¸…å•

### 4.1 Phase 1: åŸºç¡€æ¶æ„æ›´æ–°ï¼ˆ30åˆ†é’Ÿï¼‰

#### 4.1.1 æ›´æ–°æšä¸¾å’Œé…ç½®
- [ ] åœ¨ `models/base.py` ä¸­æ·»åŠ ï¼š
  - `AIProvider.AI_OPENROUTER`
  - `AIProvider.AI_OLLAMA`
- [ ] åœ¨ `DEFAULT_MODELS` ä¸­æ·»åŠ ä¸¤ä¸ªæ–°çš„ `ModelConfig`
- [ ] åœ¨ `config.py` ä¸­æ·»åŠ é»˜è®¤é…ç½®

#### 4.1.2 æ–‡ä»¶åˆ›å»º
- [ ] åˆ›å»º `models/openrouter.py`
- [ ] åˆ›å»º `models/ollama.py`

### 4.2 Phase 2: OpenRouter å®ç°ï¼ˆ1å°æ—¶ï¼‰

#### 4.2.1 æ ¸å¿ƒå®ç°
- [ ] å®ç° `OpenRouterModel` ç±»
- [ ] é‡å†™ `prepare_headers()` - æ·»åŠ å¯é€‰è¯·æ±‚å¤´
- [ ] å®ç° `get_provider_name()` å’Œ `get_model_name()`
- [ ] å®ç° `get_default_config()`
- [ ] å®ç° `_validate_config()` - éªŒè¯ API Key

#### 4.2.2 æµ‹è¯•åœºæ™¯
- [ ] Load Models - ä½¿ç”¨åŸºç±»é»˜è®¤å®ç°
- [ ] Send (æµå¼) - æµ‹è¯•æµå¼å“åº”
- [ ] Send (éæµå¼) - æµ‹è¯•éæµå¼å“åº”
- [ ] Random Question - æµ‹è¯•éæµå¼è¯·æ±‚
- [ ] è‡ªå®šä¹‰æ¨¡å‹åç§° - æµ‹è¯• use_custom_model_name

### 4.3 Phase 3: Ollama å®ç°ï¼ˆ2-3å°æ—¶ï¼‰

#### 4.3.1 æ ¸å¿ƒå®ç°
- [ ] å®ç° `OllamaModel` ç±»
- [ ] å®ç° `_validate_config()` - API Key å¯é€‰
- [ ] å®ç° `get_token()` - è¿”å›ç©ºå­—ç¬¦ä¸²
- [ ] å®ç° `validate_token()` - è·³è¿‡éªŒè¯æˆ–ç®€å•æ£€æŸ¥
- [ ] å®ç° `prepare_headers()` - åªéœ€ Content-Type
- [ ] å®ç° `prepare_request_data()` - Ollama æ ¼å¼
- [ ] å®ç° `ask()` - å®Œå…¨è‡ªå®šä¹‰
  - [ ] éæµå¼è¯·æ±‚å¤„ç†
  - [ ] æµå¼è¯·æ±‚å¤„ç†ï¼ˆç‰¹æ®Šæ ¼å¼ï¼‰
  - [ ] é”™è¯¯å¤„ç†
- [ ] å®ç° `fetch_available_models()` - ä½¿ç”¨ /api/tags
- [ ] å®ç° `get_provider_name()` å’Œ `get_model_name()`
- [ ] å®ç° `get_default_config()`

#### 4.3.2 æµå¼ä¼ è¾“ç‰¹æ®Šå¤„ç†
- [ ] è§£ææ¯è¡Œ JSON å¯¹è±¡
- [ ] æå– `message.content` å­—æ®µ
- [ ] æ£€æŸ¥ `done` æ ‡å¿—
- [ ] è°ƒç”¨ `stream_callback`

#### 4.3.3 æµ‹è¯•åœºæ™¯
- [ ] Load Models - æµ‹è¯• /api/tags ç«¯ç‚¹
- [ ] Send (æµå¼) - æµ‹è¯• Ollama æµå¼æ ¼å¼
- [ ] Send (éæµå¼) - æµ‹è¯• Ollama å“åº”æ ¼å¼
- [ ] Random Question - æµ‹è¯•éæµå¼è¯·æ±‚
- [ ] è‡ªå®šä¹‰æ¨¡å‹åç§° - æµ‹è¯• use_custom_model_name
- [ ] æœ¬åœ°è¿æ¥ - æµ‹è¯• localhost è¿æ¥

### 4.4 Phase 4: é›†æˆå’Œæ³¨å†Œï¼ˆ30åˆ†é’Ÿï¼‰

#### 4.4.1 æ¨¡å‹æ³¨å†Œ
- [ ] åœ¨ `models/__init__.py` ä¸­å¯¼å…¥æ–°æ¨¡å‹
- [ ] æ³¨å†Œåˆ° `AIModelFactory`
- [ ] æ›´æ–° `__all__` å¯¼å‡ºåˆ—è¡¨

#### 4.4.2 é…ç½®é›†æˆ
- [ ] ç¡®ä¿é…ç½®ç³»ç»Ÿæ”¯æŒæ–°å­—æ®µ
- [ ] æµ‹è¯•é…ç½®ä¿å­˜å’ŒåŠ è½½

### 4.5 Phase 5: å›½é™…åŒ–æ”¯æŒï¼ˆ30åˆ†é’Ÿï¼‰

#### 4.5.1 æ·»åŠ ç¿»è¯‘
- [ ] åœ¨æ‰€æœ‰ `i18n/*.py` æ–‡ä»¶ä¸­æ·»åŠ ï¼š
  - OpenRouter ç›¸å…³æ–‡æœ¬
  - Ollama ç›¸å…³æ–‡æœ¬
  - é”™è¯¯æ¶ˆæ¯

#### 4.5.2 è¯­è¨€åˆ—è¡¨
- [ ] `i18n/zh.py` - ç®€ä½“ä¸­æ–‡
- [ ] `i18n/zht.py` - ç¹ä½“ä¸­æ–‡
- [ ] `i18n/en.py` - è‹±è¯­
- [ ] `i18n/ja.py` - æ—¥è¯­
- [ ] `i18n/ko.py` - éŸ©è¯­
- [ ] `i18n/de.py` - å¾·è¯­
- [ ] `i18n/es.py` - è¥¿ç­ç‰™è¯­
- [ ] `i18n/fr.py` - æ³•è¯­
- [ ] `i18n/it.py` - æ„å¤§åˆ©è¯­
- [ ] `i18n/pt.py` - è‘¡è„ç‰™è¯­
- [ ] `i18n/ru.py` - ä¿„è¯­
- [ ] `i18n/nl.py` - è·å…°è¯­
- [ ] `i18n/pl.py` - æ³¢å…°è¯­
- [ ] `i18n/tr.py` - åœŸè€³å…¶è¯­
- [ ] `i18n/da.py` - ä¸¹éº¦è¯­
- [ ] `i18n/fi.py` - èŠ¬å…°è¯­
- [ ] `i18n/sv.py` - ç‘å…¸è¯­

### 4.6 Phase 6: æµ‹è¯•å’Œæ–‡æ¡£ï¼ˆ1å°æ—¶ï¼‰

#### 4.6.1 å•å…ƒæµ‹è¯•
- [ ] OpenRouter åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- [ ] Ollama åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- [ ] æµå¼ä¼ è¾“æµ‹è¯•
- [ ] é”™è¯¯å¤„ç†æµ‹è¯•

#### 4.6.2 é›†æˆæµ‹è¯•
- [ ] åœ¨ Calibre ä¸­æµ‹è¯•å®Œæ•´æµç¨‹
- [ ] æµ‹è¯•é…ç½®ä¿å­˜å’Œæ¢å¤
- [ ] æµ‹è¯•æ¨¡å‹åˆ‡æ¢

#### 4.6.3 æ–‡æ¡£æ›´æ–°
- [ ] æ›´æ–° README.md
- [ ] åˆ›å»ºä½¿ç”¨æŒ‡å—
- [ ] æ›´æ–° CHANGELOG

---

## äº”ã€æŠ€æœ¯éš¾ç‚¹å’Œæ³¨æ„äº‹é¡¹

### 5.1 OpenRouter
- âœ… **ç®€å•**: å®Œå…¨ OpenAI å…¼å®¹
- âš ï¸ **æ³¨æ„**: å¯é€‰è¯·æ±‚å¤´éœ€è¦åœ¨é…ç½®ä¸­æ”¯æŒ
- âš ï¸ **æ³¨æ„**: æ¨¡å‹åç§°å¯èƒ½å¸¦å‰ç¼€

### 5.2 Ollama
- âš ï¸ **å¤æ‚**: å®Œå…¨è‡ªå®šä¹‰ API æ ¼å¼
- âš ï¸ **æµå¼æ ¼å¼**: æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼Œä¸æ˜¯ SSE
- âš ï¸ **å“åº”æ ¼å¼**: `message.content` è€Œä¸æ˜¯ `choices[0].message.content`
- âš ï¸ **æ— è®¤è¯**: API Key å¯é€‰ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
- âš ï¸ **æœ¬åœ°æœåŠ¡**: å¯èƒ½éœ€è¦ç¦ç”¨ SSL éªŒè¯
- âš ï¸ **æ¨¡å‹åˆ—è¡¨**: ä½¿ç”¨ `/api/tags` è€Œä¸æ˜¯ `/models`

### 5.3 é€šç”¨æ³¨æ„äº‹é¡¹
- ğŸ”’ **å®‰å…¨**: ç¡®ä¿ API Key ä¸ä¼šæ³„éœ²åˆ°æ—¥å¿—
- ğŸ”„ **å…¼å®¹æ€§**: ä¿æŒå‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰æ¨¡å‹
- ğŸ“ **æ—¥å¿—**: æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âš¡ **æ€§èƒ½**: æµå¼ä¼ è¾“çš„æ€§èƒ½ä¼˜åŒ–
- ğŸ§ª **æµ‹è¯•**: å……åˆ†æµ‹è¯•æ‰€æœ‰åœºæ™¯

---

## å…­ã€æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|------|------|---------|
| Phase 1 | åŸºç¡€æ¶æ„æ›´æ–° | 30åˆ†é’Ÿ |
| Phase 2 | OpenRouter å®ç° | 1å°æ—¶ |
| Phase 3 | Ollama å®ç° | 2-3å°æ—¶ |
| Phase 4 | é›†æˆå’Œæ³¨å†Œ | 30åˆ†é’Ÿ |
| Phase 5 | å›½é™…åŒ–æ”¯æŒ | 30åˆ†é’Ÿ |
| Phase 6 | æµ‹è¯•å’Œæ–‡æ¡£ | 1å°æ—¶ |
| **æ€»è®¡** | | **5.5-6.5å°æ—¶** |

---

## ä¸ƒã€å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ï¼‰
1. âœ… OpenRouter åŸºæœ¬åŠŸèƒ½ï¼ˆLoad Models, Send, Random Questionï¼‰
2. âœ… Ollama åŸºæœ¬åŠŸèƒ½ï¼ˆLoad Models, Send, Random Questionï¼‰
3. âœ… æµå¼ä¼ è¾“æ”¯æŒ
4. âœ… è‡ªå®šä¹‰æ¨¡å‹åç§°æ”¯æŒ

### ä¸­ä¼˜å…ˆçº§ï¼ˆé‡è¦ï¼‰
1. ğŸ”¶ é”™è¯¯å¤„ç†å’Œæ—¥å¿—
2. ğŸ”¶ å›½é™…åŒ–æ”¯æŒ
3. ğŸ”¶ é…ç½®éªŒè¯

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰
1. ğŸ”¹ OpenRouter å¯é€‰è¯·æ±‚å¤´ï¼ˆHTTP-Referer, X-Titleï¼‰
2. ğŸ”¹ Ollama SSL éªŒè¯é…ç½®
3. ğŸ”¹ æ€§èƒ½ä¼˜åŒ–

---

## å…«ã€éªŒæ”¶æ ‡å‡†

### 8.1 åŠŸèƒ½éªŒæ”¶
- [ ] OpenRouter å¯ä»¥åŠ è½½æ¨¡å‹åˆ—è¡¨
- [ ] OpenRouter å¯ä»¥å‘é€é—®é¢˜å¹¶è·å–å›ç­”ï¼ˆæµå¼å’Œéæµå¼ï¼‰
- [ ] OpenRouter å¯ä»¥ç”Ÿæˆéšæœºé—®é¢˜
- [ ] Ollama å¯ä»¥åŠ è½½æ¨¡å‹åˆ—è¡¨
- [ ] Ollama å¯ä»¥å‘é€é—®é¢˜å¹¶è·å–å›ç­”ï¼ˆæµå¼å’Œéæµå¼ï¼‰
- [ ] Ollama å¯ä»¥ç”Ÿæˆéšæœºé—®é¢˜
- [ ] è‡ªå®šä¹‰æ¨¡å‹åç§°åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] é…ç½®å¯ä»¥æ­£ç¡®ä¿å­˜å’ŒåŠ è½½

### 8.2 è´¨é‡éªŒæ”¶
- [ ] ä»£ç éµå¾ªç°æœ‰ä»£ç é£æ ¼
- [ ] æ‰€æœ‰æ–¹æ³•éƒ½æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ—¥å¿—è®°å½•è¯¦ç»†
- [ ] å›½é™…åŒ–æ”¯æŒå®Œæ•´

### 8.3 å…¼å®¹æ€§éªŒæ”¶
- [ ] ä¸å½±å“ç°æœ‰æ¨¡å‹åŠŸèƒ½
- [ ] é…ç½®å‘åå…¼å®¹
- [ ] åœ¨ Calibre ä¸­æ­£å¸¸è¿è¡Œ

---

## ä¹ã€é£é™©è¯„ä¼°

### 9.1 æŠ€æœ¯é£é™©
- **Ollama æµå¼æ ¼å¼**: ä¸æ ‡å‡† SSE ä¸åŒï¼Œéœ€è¦ç‰¹æ®Šå¤„ç† â†’ **ä¸­ç­‰é£é™©**
- **Ollama å“åº”æ ¼å¼**: è‡ªå®šä¹‰æ ¼å¼ï¼Œéœ€è¦å®Œå…¨é‡å†™ â†’ **ä¸­ç­‰é£é™©**
- **æœ¬åœ°è¿æ¥**: Ollama æœ¬åœ°æœåŠ¡å¯èƒ½æœ‰è¿æ¥é—®é¢˜ â†’ **ä½é£é™©**

### 9.2 å…¼å®¹æ€§é£é™©
- **å‘åå…¼å®¹**: æ·»åŠ æ–°æ¨¡å‹ä¸åº”å½±å“ç°æœ‰åŠŸèƒ½ â†’ **ä½é£é™©**
- **é…ç½®è¿ç§»**: ç°æœ‰é…ç½®åº”è¯¥ç»§ç»­å·¥ä½œ â†’ **ä½é£é™©**

### 9.3 ç¼“è§£æªæ–½
- å……åˆ†æµ‹è¯•æ‰€æœ‰åœºæ™¯
- å‚è€ƒç°æœ‰æ¨¡å‹å®ç°ï¼ˆå¦‚ Gemini çš„è‡ªå®šä¹‰æ ¼å¼ï¼‰
- æ·»åŠ è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- åœ¨å¼€å‘ç¯å¢ƒä¸­å…ˆæµ‹è¯•ï¼Œå†éƒ¨ç½²åˆ°ç”Ÿäº§

---

## åã€å‚è€ƒèµ„æ–™

### 10.1 API æ–‡æ¡£
- OpenRouter API: https://openrouter.ai/docs
- Ollama API: https://github.com/ollama/ollama/blob/main/docs/api.md

### 10.2 ç°æœ‰å®ç°å‚è€ƒ
- `models/openai.py` - OpenAI å…¼å®¹å®ç°
- `models/gemini.py` - è‡ªå®šä¹‰ API æ ¼å¼å®ç°
- `models/custom.py` - æœ¬åœ°æ¨¡å‹å®ç°

### 10.3 ç›¸å…³æ–‡æ¡£
- `aiprovider/openrouter.md` - OpenRouter é…ç½®æŒ‡å—
- `aiprovider/ollama.md` - Ollama é…ç½®æŒ‡å—
- `docs/CRITICAL_RULES.md` - å¼€å‘è§„åˆ™
- `docs/PROJECT_STRUCTURE.md` - é¡¹ç›®ç»“æ„

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-22  
**çŠ¶æ€**: å¾…å®æ–½
